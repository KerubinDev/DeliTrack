{% extends "base.html" %}

{% block title %}Painel da Cozinha{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/cozinha.css') }}">
{% endblock %}

{% block content %}
<div class="cozinha-container">
    <header class="kitchen-header">
        <div class="header-info">
            <h1>Painel da Cozinha</h1>
            <div class="status-indicators">
                <div class="indicator">
                    <span class="dot waiting"></span>
                    <span>Aguardando ({{ pedidos_aguardando|length }})</span>
                </div>
                <div class="indicator">
                    <span class="dot preparing"></span>
                    <span>Em Preparo ({{ pedidos_preparando|length }})</span>
                </div>
                <div class="indicator">
                    <span class="dot ready"></span>
                    <span>Prontos ({{ pedidos_prontos|length }})</span>
                </div>
            </div>
        </div>
        <div class="timer-display">
            <i class="fas fa-clock"></i>
            <span id="currentTime">00:00:00</span>
        </div>
    </header>

    <div class="pedidos-timeline">
        {% for pedido in pedidos %}
        <div class="pedido-timeline-item" data-tempo="{{ pedido.tempo_estimado }}">
            <div class="timeline-marker"></div>
            <span class="timeline-time">{{ pedido.tempo_restante }}min</span>
        </div>
        {% endfor %}
    </div>

    <div class="pedidos-grid">
        <!-- Coluna de Pedidos Aguardando -->
        <div class="pedidos-column waiting-column">
            <h2>Aguardando Preparo</h2>
            <div class="pedidos-list" id="listaPedidosAguardando">
                {% for pedido in pedidos_aguardando %}
                <div class="pedido-card" data-id="{{ pedido.id }}" 
                     draggable="true" ondragstart="drag(event)">
                    <div class="pedido-timer" data-created="{{ pedido.data_criacao }}">
                        <i class="fas fa-hourglass-start"></i>
                        <span class="tempo-espera">0:00</span>
                    </div>
                    <div class="pedido-info">
                        <div class="pedido-header">
                            <span class="pedido-id">#{{ pedido.id }}</span>
                            <span class="pedido-mesa">Mesa {{ pedido.mesa }}</span>
                            <span class="pedido-garcom">{{ pedido.garcom.nome }}</span>
                        </div>
                        <div class="pedido-items">
                            {% for item in pedido.itens %}
                            <div class="item">
                                <span class="quantidade">{{ item.quantidade }}x</span>
                                <div class="item-details">
                                    <span class="nome">{{ item.produto.nome }}</span>
                                    {% if item.observacoes %}
                                    <span class="observacoes">{{ item.observacoes }}</span>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                        <div class="pedido-actions">
                            <button class="btn-action" onclick="iniciarPreparo({{ pedido.id }})">
                                Iniciar Preparo
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Coluna de Pedidos em Preparo -->
        <div class="pedidos-column preparing-column">
            <h2>Em Preparo</h2>
            <div class="pedidos-list" id="listaPedidosPreparando"
                 ondrop="drop(event)" ondragover="allowDrop(event)">
                {% for pedido in pedidos_preparando %}
                <div class="pedido-card preparing" data-id="{{ pedido.id }}">
                    <!-- Conteúdo similar ao card anterior -->
                    <div class="progress-bar">
                        <div class="progress" style="width: {{ pedido.progresso }}%"></div>
                    </div>
                    <div class="pedido-actions">
                        <button class="btn-action" onclick="marcarPronto({{ pedido.id }})">
                            Marcar como Pronto
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Coluna de Pedidos Prontos -->
        <div class="pedidos-column ready-column">
            <h2>Prontos para Entrega</h2>
            <div class="pedidos-list" id="listaPedidosProntos">
                {% for pedido in pedidos_prontos %}
                <div class="pedido-card ready" data-id="{{ pedido.id }}">
                    <!-- Conteúdo similar ao card anterior -->
                    <div class="pedido-actions">
                        <button class="btn-secondary" onclick="desfazerPronto({{ pedido.id }})">
                            Desfazer
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalhes do Pedido -->
<div class="modal" id="modalDetalhesPedido">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Detalhes do Pedido #<span id="modalPedidoId"></span></h2>
            <button class="btn-icon" onclick="fecharModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body">
            <!-- Conteúdo preenchido via JavaScript -->
        </div>
    </div>
</div>
{% endblock %} 